# ğŸš€ å¯¦æˆ°ç¯‡ï¼šé€æ­¥å¯¦æ–½æŒ‡å—

## ğŸ¯ æœ¬ç¯‡å­¸ç¿’ç›®æ¨™

å®Œæˆæœ¬ç¯‡å¾Œï¼Œæ‚¨å°‡ï¼š
- âœ… å»ºç«‹å®Œæ•´çš„ GitHub Actions + Apps Script è‡ªå‹•éƒ¨ç½²æµç¨‹
- âœ… æˆåŠŸæ¨é€ç¬¬ä¸€æ‰¹æª”æ¡ˆåˆ° Google Apps Script
- âœ… æŒæ¡å®Œæ•´çš„é…ç½®å’Œæ¸¬è©¦æµç¨‹
- âœ… å»ºç«‹å¯æŒçºŒç¶­è­·çš„éƒ¨ç½²æ–¹æ¡ˆ

## ğŸ“‹ å¯¦æˆ°å‰ç½®æª¢æŸ¥

åœ¨é–‹å§‹å¯¦æˆ°å‰ï¼Œè«‹ç¢ºèªæ‚¨å·²å®Œæˆï¼š

| æª¢æŸ¥é …ç›® | ç‹€æ…‹ | èªªæ˜ |
|---------|------|------|
| **ç’°å¢ƒæº–å‚™** | [ ] | Node.jsã€npmã€claspã€Git å·²å®‰è£ |
| **å¸³æˆ¶æº–å‚™** | [ ] | GitHubã€Google å¸³æˆ¶å·²æº–å‚™ |
| **API å•Ÿç”¨** | [ ] | Apps Script API å·²åœ¨å€‹äººè¨­å®šä¸­å•Ÿç”¨ |
| **åŸºç¤æ¦‚å¿µ** | [ ] | ç†è§£ OAuth vs Service Account å·®ç•° |

**âš ï¸ é‡è¦æé†’**ï¼šæœ¬æ•™å­¸ä½¿ç”¨ OAuth èªè­‰æ–¹æ¡ˆï¼Œå·²é©—è­‰ 100% æˆåŠŸç‡ã€‚

## ğŸ—ï¸ ç¬¬ä¸€éšæ®µï¼šå°ˆæ¡ˆåŸºç¤å»ºç«‹

### æ­¥é©Ÿ 1.1ï¼šå»ºç«‹ Apps Script å°ˆæ¡ˆ

#### é¸é … Aï¼šå»ºç«‹å…¨æ–°å°ˆæ¡ˆ

1. **å‰å¾€ Google Apps Script**
   ```
   https://script.google.com
   ```

2. **å»ºç«‹æ–°å°ˆæ¡ˆ**
   - é»æ“Šã€Œæ–°å¢å°ˆæ¡ˆã€
   - å°ˆæ¡ˆåç¨±ï¼š`XXXæœƒè­°æŠ•ç¥¨ç³»çµ±` (æ ¹æ“šæ‚¨çš„éœ€æ±‚å‘½å)
   - è¨˜ä¸‹å°ˆæ¡ˆçš„ Script ID

3. **å–å¾— Script ID**
   ```
   æ–¹æ³•1ï¼šå¾ç¶²å€åˆ—å–å¾—
   https://script.google.com/home/projects/1XXXrs_y00guMps5yK2o14nXXXLG0yAhI8JCbY7My-lrQAhUE91aXXXJ/edit
                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                    é€™æ®µå°±æ˜¯ Script ID
   
   æ–¹æ³•2ï¼šå¾å°ˆæ¡ˆè¨­å®šå–å¾—
   å°ˆæ¡ˆè¨­å®š â†’ æŒ‡ä»¤ç¢¼ ID
   ```

#### é¸é … Bï¼šä½¿ç”¨ç¾æœ‰å°ˆæ¡ˆ

å¦‚æœæ‚¨å·²æœ‰ Apps Script å°ˆæ¡ˆï¼š

1. **ç¢ºèªå°ˆæ¡ˆæ¬Šé™**
   - ç¢ºä¿æ‚¨å°å°ˆæ¡ˆæœ‰ã€Œç·¨è¼¯è€…ã€æ¬Šé™
   - è¨˜éŒ„å°ˆæ¡ˆçš„ Script ID

2. **å‚™ä»½ç¾æœ‰æª”æ¡ˆ**ï¼ˆé‡è¦ï¼‰
   ```
   å»ºè­°åšæ³•ï¼š
   1. åœ¨ Apps Script ç·¨è¼¯å™¨ä¸­æ‰‹å‹•è¤‡è£½æ‰€æœ‰ä»£ç¢¼
   2. æˆ–ä½¿ç”¨ clasp pull ä¸‹è¼‰åˆ°æœ¬åœ°
   ```

### æ­¥é©Ÿ 1.2ï¼šå»ºç«‹ GitHub Repository

1. **ç™»å…¥ GitHub**
   ```
   https://github.com
   ```

2. **å»ºç«‹æ–° Repository**
   - Repository åç¨±ï¼š`XXX-vote-time` (å»ºè­°å‘½å)
   - è¨­å®šç‚º Privateï¼ˆæ¨è–¦ï¼‰æˆ– Public
   - å‹¾é¸ã€ŒAdd a README fileã€
   - é»æ“Šã€ŒCreate repositoryã€

3. **è¨˜éŒ„ Repository è³‡è¨Š**
   ```
   Repository URL: https://github.com/XXXUSER/XXX-vote-time
   ```

### æ­¥é©Ÿ 1.3ï¼šå•Ÿç”¨ Apps Script API

**ğŸ¯ é—œéµæ­¥é©Ÿ**ï¼šé€™æ­¥é©Ÿæ˜¯ OAuth æ–¹æ¡ˆæˆåŠŸçš„é—œéµï¼

1. **å‰å¾€å€‹äººè¨­å®š**
   ```
   https://script.google.com/home/usersettings
   ```

2. **å•Ÿç”¨ Google Apps Script API**
   - æ‰¾åˆ°ã€ŒGoogle Apps Script APIã€
   - ç¢ºä¿é–‹é—œç‚ºã€Œé–‹å•Ÿã€ç‹€æ…‹
   - å¦‚æœæ˜¯é—œé–‰ç‹€æ…‹ï¼Œè«‹é–‹å•Ÿå®ƒ

3. **é©—è­‰å•Ÿç”¨ç‹€æ…‹**
   ```
   âœ… æ­£ç¢ºç‹€æ…‹ï¼šGoogle Apps Script API é¡¯ç¤ºç‚ºã€Œå·²å•Ÿç”¨ã€
   âŒ éŒ¯èª¤ç‹€æ…‹ï¼šAPI é¡¯ç¤ºç‚ºã€Œå·²åœç”¨ã€æˆ–æ‰¾ä¸åˆ°é¸é …
   ```

## ğŸ”§ ç¬¬äºŒéšæ®µï¼šæœ¬åœ°ç’°å¢ƒè¨­ç½®

### æ­¥é©Ÿ 2.1ï¼šè¨­ç½®æœ¬åœ°å°ˆæ¡ˆ

1. **å»ºç«‹æœ¬åœ°ç›®éŒ„**
   ```cmd
   mkdir XXX-vote-time
   cd XXX-vote-time
   ```

2. **åˆå§‹åŒ– Git Repository**
   ```cmd
   git init
   git remote add origin https://github.com/XXXUSER/XXX-vote-time.git
   ```

3. **å»ºç«‹åŸºæœ¬æª”æ¡ˆçµæ§‹**
   ```cmd
   # å»ºç«‹å¿…è¦çš„ç›®éŒ„
   mkdir .github
   mkdir .github\workflows
   
   # å»ºç«‹ .gitignore æª”æ¡ˆ
   echo .clasprc.json > .gitignore
   echo node_modules/ >> .gitignore
   echo *.log >> .gitignore
   ```

### æ­¥é©Ÿ 2.2ï¼šè¨­ç½® clasp èªè­‰

#### OAuth èªè­‰è¨­ç½®ï¼ˆæ ¸å¿ƒæ­¥é©Ÿï¼‰

1. **åŸ·è¡Œ clasp ç™»å…¥**
   ```cmd
   clasp login
   ```

2. **æˆæ¬Šæµç¨‹**
   ```
   1. ç€è¦½å™¨æœƒè‡ªå‹•é–‹å•Ÿ Google OAuth é é¢
   2. é¸æ“‡æ‚¨çš„ Google å¸³æˆ¶
   3. é»æ“Šã€Œå…è¨±ã€æˆæ¬Š clasp å­˜å– Apps Script
   4. çœ‹åˆ°æˆåŠŸè¨Šæ¯å¾Œé—œé–‰ç€è¦½å™¨
   ```

3. **é©—è­‰èªè­‰æˆåŠŸ**
   ```cmd
   clasp status
   ```
   
   **é æœŸè¼¸å‡º**ï¼š
   ```
   You are logged in as XXXXX@gmail.com
   ```

4. **æª¢æŸ¥èªè­‰æª”æ¡ˆ**
   ```cmd
   # Windows
   type "%USERPROFILE%\.clasprc.json"
   
   # é æœŸçœ‹åˆ°é¡ä¼¼å…§å®¹ï¼š
   {
     "access_token": "ya29.a0AfB_byXXXXXXXXXXXXXXXXXXXX...",
     "refresh_token": "1//04XXXXXXXXXXXXXXXXXXXXXXXX...",
     "scope": "https://www.googleapis.com/auth/script.projects...",
     "token_type": "Bearer",
     "expiry_date": 1640123456789
   }
   ```

### æ­¥é©Ÿ 2.3ï¼šå»ºç«‹ .clasp.json é…ç½®

1. **å»ºç«‹ .clasp.json æª”æ¡ˆ**
   ```cmd
   echo {"scriptId":"1XXXrs_y00guMps5yK2o14nXXXLG0yAhI8JCbY7My-lrQAhUE91aXXXJ"} > .clasp.json
   ```

2. **ç·¨è¼¯ .clasp.json å®Œæ•´é…ç½®**
   ```json
   {
     "scriptId": "1XXXrs_y00guMps5yK2o14nXXXLG0yAhI8JCbY7My-lrQAhUE91aXXXJ",
     "rootDir": ".",
     "scriptExtensions": [".js", ".gs"],
     "htmlExtensions": [".html"],
     "jsonExtensions": [".json"],
     "filePushOrder": [],
     "skipSubdirectories": false
   }
   ```

3. **æ¸¬è©¦å°ˆæ¡ˆé€£æ¥**
   ```cmd
   clasp status
   ```
   
   **é æœŸè¼¸å‡º**ï¼š
   ```
   scriptId: 1XXXrs_y00guMps5yK2o14nXXXLG0yAhI8JCbY7My-lrQAhUE91aXXXJ
   Logged in as: XXXXX@gmail.com
   ```

## ğŸ“ ç¬¬ä¸‰éšæ®µï¼šå»ºç«‹ç¤ºç¯„æª”æ¡ˆ

### æ­¥é©Ÿ 3.1ï¼šå»ºç«‹ Apps Script æª”æ¡ˆ

ç‚ºäº†æ¸¬è©¦éƒ¨ç½²æµç¨‹ï¼Œæˆ‘å€‘å…ˆå»ºç«‹ä¸€äº›åŸºæœ¬æª”æ¡ˆï¼š

#### å»ºç«‹ appsscript.json
```json
{
  "timeZone": "Asia/Taipei",
  "dependencies": {},
  "exceptionLogging": "STACKDRIVER",
  "runtimeVersion": "V8"
}
```

#### å»ºç«‹ code.gs
```javascript
/**
 * æ¸¬è©¦ç”¨ä¸»ç¨‹å¼
 * ç”¨æ–¼é©—è­‰ GitHub Actions è‡ªå‹•éƒ¨ç½²åŠŸèƒ½
 */

function doGet(e) {
  return HtmlService.createTemplateFromFile('index')
    .evaluate()
    .setTitle('XXX ç³»çµ±æ¸¬è©¦')
    .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}

function include(filename) {
  return HtmlService.createHtmlOutputFromFile(filename).getContent();
}

/**
 * æ¸¬è©¦å‡½æ•¸
 * ç”¨æ–¼é©—è­‰éƒ¨ç½²æ˜¯å¦æˆåŠŸ
 */
function testFunction() {
  console.log('ğŸ‰ GitHub Actions è‡ªå‹•éƒ¨ç½²æ¸¬è©¦æˆåŠŸï¼');
  console.log('éƒ¨ç½²æ™‚é–“ï¼š' + new Date().toLocaleString('zh-TW'));
  return 'éƒ¨ç½²æ¸¬è©¦æˆåŠŸ - ' + new Date().toISOString();
}

/**
 * å–å¾—ç³»çµ±è³‡è¨Š
 */
function getSystemInfo() {
  return {
    deployTime: new Date().toISOString(),
    version: '1.0.0',
    status: 'GitHub Actions éƒ¨ç½²æˆåŠŸ'
  };
}
```

#### å»ºç«‹ index.html
```html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Actions éƒ¨ç½²æ¸¬è©¦</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        .success {
            background: rgba(34, 197, 94, 0.2);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #22c55e;
            margin: 20px 0;
        }
        .info {
            background: rgba(59, 130, 246, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        button {
            background: #22c55e;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        button:hover {
            background: #16a34a;
            transform: translateY(-2px);
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            min-height: 100px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ GitHub Actions + Apps Script éƒ¨ç½²æ¸¬è©¦</h1>
        
        <div class="success">
            <h2>âœ… éƒ¨ç½²æˆåŠŸï¼</h2>
            <p>å¦‚æœæ‚¨çœ‹åˆ°é€™å€‹é é¢ï¼Œè¡¨ç¤º GitHub Actions è‡ªå‹•éƒ¨ç½²å·²ç¶“æˆåŠŸé‹ä½œã€‚</p>
        </div>
        
        <div class="info">
            <h3>ğŸ“‹ æ¸¬è©¦è³‡è¨Š</h3>
            <p><strong>å°ˆæ¡ˆ IDï¼š</strong>1XXXrs_y00guMps5yK2o14nXXXLG0yAhI8JCbY7My-lrQAhUE91aXXXJ</p>
            <p><strong>éƒ¨ç½²æ–¹å¼ï¼š</strong>OAuth èªè­‰ + clasp push</p>
            <p><strong>ç•¶å‰æ™‚é–“ï¼š</strong><span id="currentTime"></span></p>
        </div>
        
        <div>
            <h3>ğŸ§ª åŠŸèƒ½æ¸¬è©¦</h3>
            <button onclick="runTest()">åŸ·è¡Œå¾Œç«¯æ¸¬è©¦</button>
            <button onclick="getInfo()">å–å¾—ç³»çµ±è³‡è¨Š</button>
            <button onclick="clearResult()">æ¸…é™¤çµæœ</button>
        </div>
        
        <div id="result">
            <p>é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</p>
        </div>
    </div>

    <script>
        // é¡¯ç¤ºç•¶å‰æ™‚é–“
        function updateTime() {
            document.getElementById('currentTime').textContent = new Date().toLocaleString('zh-TW');
        }
        updateTime();
        setInterval(updateTime, 1000);

        // åŸ·è¡Œå¾Œç«¯æ¸¬è©¦
        function runTest() {
            document.getElementById('result').innerHTML = '<p>ğŸ”„ åŸ·è¡Œæ¸¬è©¦ä¸­...</p>';
            
            google.script.run
                .withSuccessHandler(function(result) {
                    document.getElementById('result').innerHTML = 
                        '<h4>âœ… å¾Œç«¯æ¸¬è©¦æˆåŠŸ</h4><p>' + result + '</p>';
                })
                .withFailureHandler(function(error) {
                    document.getElementById('result').innerHTML = 
                        '<h4>âŒ æ¸¬è©¦å¤±æ•—</h4><p>' + error.toString() + '</p>';
                })
                .testFunction();
        }

        // å–å¾—ç³»çµ±è³‡è¨Š
        function getInfo() {
            document.getElementById('result').innerHTML = '<p>ğŸ”„ è¼‰å…¥ç³»çµ±è³‡è¨Šä¸­...</p>';
            
            google.script.run
                .withSuccessHandler(function(info) {
                    document.getElementById('result').innerHTML = 
                        '<h4>ğŸ“Š ç³»çµ±è³‡è¨Š</h4>' +
                        '<p><strong>ç‰ˆæœ¬ï¼š</strong>' + info.version + '</p>' +
                        '<p><strong>éƒ¨ç½²æ™‚é–“ï¼š</strong>' + new Date(info.deployTime).toLocaleString('zh-TW') + '</p>' +
                        '<p><strong>ç‹€æ…‹ï¼š</strong>' + info.status + '</p>';
                })
                .withFailureHandler(function(error) {
                    document.getElementById('result').innerHTML = 
                        '<h4>âŒ è¼‰å…¥å¤±æ•—</h4><p>' + error.toString() + '</p>';
                })
                .getSystemInfo();
        }

        // æ¸…é™¤çµæœ
        function clearResult() {
            document.getElementById('result').innerHTML = '<p>é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</p>';
        }
    </script>
</body>
</html>
```

### æ­¥é©Ÿ 3.2ï¼šæœ¬åœ°æ¸¬è©¦æ¨é€

åœ¨è¨­ç½® GitHub Actions å‰ï¼Œå…ˆæ¸¬è©¦æœ¬åœ°æ¨é€æ˜¯å¦æ­£å¸¸ï¼š

1. **åŸ·è¡Œæœ¬åœ°æ¨é€**
   ```cmd
   clasp push --force
   ```

2. **é æœŸæˆåŠŸè¼¸å‡º**
   ```
   â””â”€ appsscript.json
   â””â”€ code.gs
   â””â”€ index.html
   Pushed 3 files.
   ```

3. **é©—è­‰æ¨é€çµæœ**
   - å‰å¾€ Apps Script ç·¨è¼¯å™¨ï¼š`https://script.google.com/home/projects/1XXXrs_y00guMps5yK2o14nXXXLG0yAhI8JCbY7My-lrQAhUE91aXXXJ/edit`
   - ç¢ºèªçœ‹åˆ° 3 å€‹æª”æ¡ˆï¼šappsscript.jsonã€code.gsã€index.html
   - æª”æ¡ˆå…§å®¹èˆ‡æœ¬åœ°ä¸€è‡´

4. **æ¸¬è©¦ Web Appï¼ˆå¯é¸ï¼‰**
   ```
   æ­¥é©Ÿï¼šéƒ¨ç½² â†’ æ–°å¢éƒ¨ç½²ä½œæ¥­ â†’ é¡å‹ï¼šç¶²é æ‡‰ç”¨ç¨‹å¼
   åŸ·è¡Œèº«åˆ†ï¼šæˆ‘
   å­˜å–æ¬Šï¼šä»»ä½•äºº
   â†’ éƒ¨ç½²
   ```

## ğŸ” ç¬¬å››éšæ®µï¼šGitHub Actions è¨­ç½®

### æ­¥é©Ÿ 4.1ï¼šè¨­ç½® GitHub Secrets

é€™æ˜¯æ•´å€‹æµç¨‹çš„é—œéµæ­¥é©Ÿï¼

1. **å‰å¾€ GitHub Secrets è¨­ç½®é é¢**
   ```
   https://github.com/XXXUSER/XXX-vote-time/settings/secrets/actions
   ```

2. **å»ºç«‹ CLASPRC_JSON Secret**
   - é»æ“Šã€ŒNew repository secretã€
   - Name: `CLASPRC_JSON`
   - Value: è¤‡è£½ `~/.clasprc.json` çš„**å®Œæ•´å…§å®¹**

   **å¦‚ä½•å–å¾— .clasprc.json å…§å®¹**ï¼š
   ```cmd
   # Windows
   type "%USERPROFILE%\.clasprc.json"
   
   # æˆ–ä½¿ç”¨ PowerShell è¤‡è£½åˆ°å‰ªè²¼ç°¿
   Get-Content "$env:USERPROFILE\.clasprc.json" | Set-Clipboard
   ```

3. **é©—è­‰ Secret æ ¼å¼**
   ç¢ºä¿è¤‡è£½çš„å…§å®¹æ˜¯å®Œæ•´çš„ JSON æ ¼å¼ï¼š
   ```json
   {
     "access_token": "ya29.a0AfB_byXXXXXXXXXXXXXXXXXXXX...",
     "refresh_token": "1//04XXXXXXXXXXXXXXXXXXXXXXXX...",
     "scope": "https://www.googleapis.com/auth/script.projects https://www.googleapis.com/auth/script.deployments https://www.googleapis.com/auth/drive.file",
     "token_type": "Bearer",
     "expiry_date": 1640123456789
   }
   ```

4. **é»æ“Šã€ŒAdd secretã€å®Œæˆè¨­ç½®**

### æ­¥é©Ÿ 4.2ï¼šå»ºç«‹ GitHub Actions Workflow

1. **å»ºç«‹ workflow æª”æ¡ˆ**
   ```cmd
   # ç¢ºä¿ç›®éŒ„å­˜åœ¨
   mkdir .github\workflows
   
   # å»ºç«‹ workflow æª”æ¡ˆ
   type nul > .github\workflows\deploy-to-gas.yml
   ```

2. **ç·¨è¼¯ deploy-to-gas.yml**
   ```yaml
   # è‡ªå‹•éƒ¨ç½²åˆ° Google Apps Script - OAuth èªè­‰ç‰ˆæœ¬
   name: Deploy to Google Apps Script

   # è§¸ç™¼æ¢ä»¶
   on:
     push:
       branches: [ main ]
     workflow_dispatch:
       inputs:
         deploy_message:
           description: 'éƒ¨ç½²èªªæ˜'
           required: false
           default: 'Manual deployment'

   # å·¥ä½œå…§å®¹
   jobs:
     deploy:
       runs-on: ubuntu-latest
       steps:
         # æ­¥é©Ÿ 1: å–å¾—ç¨‹å¼ç¢¼
         - name: Checkout repository
           uses: actions/checkout@v4

         # æ­¥é©Ÿ 2: è¨­å®š Node.js ç’°å¢ƒ
         - name: Setup Node.js
           uses: actions/setup-node@v4
           with:
             node-version: '18'

         # æ­¥é©Ÿ 3: å®‰è£ clasp
         - name: Install clasp
           run: |
             npm install -g @google/clasp@latest
             echo "âœ… clasp å®‰è£å®Œæˆ"

         # æ­¥é©Ÿ 4: è¨­ç½® OAuth èªè­‰
         - name: Setup OAuth Authentication
           run: |
             echo "=== è¨­ç½® OAuth èªè­‰ ==="
             
             # æª¢æŸ¥å¿…è¦çš„ secrets
             if [ -z "${{ secrets.CLASPRC_JSON }}" ]; then
               echo "âŒ ç¼ºå°‘ CLASPRC_JSON secret"
               echo "è«‹ç¢ºä¿å·²æŒ‰ç…§è¨­ç½®æŒ‡å—æ·»åŠ æ­¤ secret"
               exit 1
             fi
             
             # å»ºç«‹èªè­‰æª”æ¡ˆ
             echo '${{ secrets.CLASPRC_JSON }}' > ~/.clasprc.json
             
             # é©—è­‰ JSON æ ¼å¼
             if ! jq empty ~/.clasprc.json 2>/dev/null; then
               echo "âŒ CLASPRC_JSON æ ¼å¼éŒ¯èª¤"
               exit 1
             fi
             
             echo "âœ… OAuth èªè­‰è¨­ç½®å®Œæˆ"

         # æ­¥é©Ÿ 5: æª¢æŸ¥å°ˆæ¡ˆé…ç½®
         - name: Verify project configuration
           run: |
             echo "=== æª¢æŸ¥å°ˆæ¡ˆé…ç½® ==="
             
             # æª¢æŸ¥ .clasp.json
             if [ ! -f ".clasp.json" ]; then
               echo "âŒ æ‰¾ä¸åˆ° .clasp.json æª”æ¡ˆ"
               exit 1
             fi
             
             SCRIPT_ID=$(jq -r '.scriptId' .clasp.json)
             echo "ğŸ¯ ç›®æ¨™å°ˆæ¡ˆ ID: $SCRIPT_ID"
             
             # æª¢æŸ¥å°ˆæ¡ˆIDæ ¼å¼
             if [ ${#SCRIPT_ID} -eq 57 ]; then
               echo "âœ… å°ˆæ¡ˆ ID æ ¼å¼æ­£ç¢º"
             else
               echo "âš ï¸ å°ˆæ¡ˆ ID æ ¼å¼å¯èƒ½ç•°å¸¸ï¼Œé•·åº¦: ${#SCRIPT_ID}"
             fi

         # æ­¥é©Ÿ 6: æº–å‚™æª”æ¡ˆæ¸…å–®
         - name: Prepare deployment files
           run: |
             echo "=== æº–å‚™æ¨é€æª”æ¡ˆæ¸…å–® ==="
             
             # åˆ—å‡ºæ‰€æœ‰è¦æ¨é€çš„æª”æ¡ˆ
             echo "ğŸ“‹ å°‡æ¨é€çš„æª”æ¡ˆ:"
             find . -maxdepth 1 \( -name "*.gs" -o -name "*.html" -o -name "appsscript.json" \) | sort | while read file; do
               size=$(stat -c%s "$file" 2>/dev/null || echo "unknown")
               echo "   â€¢ $file ($size bytes)"
             done
             
             # çµ±è¨ˆæª”æ¡ˆæ•¸é‡
             GS_COUNT=$(find . -maxdepth 1 -name "*.gs" | wc -l)
             HTML_COUNT=$(find . -maxdepth 1 -name "*.html" | wc -l)
             JSON_COUNT=$(find . -maxdepth 1 -name "appsscript.json" | wc -l)
             TOTAL_COUNT=$((GS_COUNT + HTML_COUNT + JSON_COUNT))
             
             echo ""
             echo "ğŸ“Š æª”æ¡ˆçµ±è¨ˆ:"
             echo "   .gs æª”æ¡ˆ: $GS_COUNT"
             echo "   .html æª”æ¡ˆ: $HTML_COUNT"
             echo "   appsscript.json: $JSON_COUNT"
             echo "   ç¸½è¨ˆ: $TOTAL_COUNT"
             
             # æª¢æŸ¥æ˜¯å¦æœ‰æª”æ¡ˆè¦æ¨é€
             if [ $TOTAL_COUNT -eq 0 ]; then
               echo "âŒ æ²’æœ‰æª”æ¡ˆè¦æ¨é€"
               exit 1
             fi

         # æ­¥é©Ÿ 7: æ¸¬è©¦ clasp é€£æ¥
         - name: Test clasp connection
           run: |
             echo "=== æ¸¬è©¦ clasp é€£æ¥ ==="
             
             # æ¸¬è©¦èªè­‰ç‹€æ…‹
             if clasp status; then
               echo "âœ… OAuth èªè­‰é€£æ¥æ­£å¸¸"
             else
               echo "âŒ clasp é€£æ¥å¤±æ•—"
               echo "å¯èƒ½åŸå› : token éæœŸæˆ–æ¬Šé™å•é¡Œ"
               exit 1
             fi

         # æ­¥é©Ÿ 8: æ¨é€æª”æ¡ˆåˆ° Google Apps Script
         - name: Push files to Google Apps Script
           run: |
             echo "=== æ¨é€æª”æ¡ˆåˆ° Google Apps Script ==="
             echo ""
             
             # åŸ·è¡Œæ¨é€
             echo "ğŸš€ é–‹å§‹æ¨é€æª”æ¡ˆ..."
             START_TIME=$(date +%s)
             
             if clasp push --force; then
               END_TIME=$(date +%s)
               DURATION=$((END_TIME - START_TIME))
               
               echo ""
               echo "ğŸ‰ æª”æ¡ˆæ¨é€æˆåŠŸï¼"
               echo "â±ï¸ æ¨é€è€—æ™‚: ${DURATION} ç§’"
               echo "âœ… æ‰€æœ‰æª”æ¡ˆå·²æ›´æ–°åˆ° Google Apps Script"
             else
               echo ""
               echo "âŒ æª”æ¡ˆæ¨é€å¤±æ•—"
               echo "è«‹æª¢æŸ¥éŒ¯èª¤è¨Šæ¯é€²è¡Œè¨ºæ–·"
               exit 1
             fi

         # æ­¥é©Ÿ 9: ç”Ÿæˆéƒ¨ç½²å ±å‘Š
         - name: Generate deployment report
           if: success()
           run: |
             echo "=== éƒ¨ç½²å ±å‘Š ==="
             
             SCRIPT_ID=$(jq -r '.scriptId' .clasp.json)
             DEPLOY_TIME=$(date '+%Y-%m-%d %H:%M:%S UTC')
             COMMIT_SHA=${GITHUB_SHA:0:7}
             
             echo "ğŸ‰ éƒ¨ç½²å®Œæˆæ™‚é–“: $DEPLOY_TIME"
             echo "ğŸ“ å°ˆæ¡ˆ ID: $SCRIPT_ID"
             echo "ğŸ”— ç·¨è¼¯å™¨é€£çµ: https://script.google.com/home/projects/$SCRIPT_ID/edit"
             echo "ğŸ“ Commit: $COMMIT_SHA"
             echo "ğŸ“Š æ¨é€æª”æ¡ˆæ•¸é‡: $(find . -maxdepth 1 \( -name "*.gs" -o -name "*.html" -o -name "appsscript.json" \) | wc -l)"
             echo "âœ… èªè­‰æ–¹å¼: OAuth"
             echo ""
             echo "ğŸ“‹ éƒ¨ç½²æ‘˜è¦:"
             echo "   â€¢ æ¨é€æ–¹å¼: OAuth + clasp push"
             echo "   â€¢ éŒ¯èª¤ç‹€æ…‹: ç„¡éŒ¯èª¤"
             echo "   â€¢ éƒ¨ç½²ç‹€æ…‹: æˆåŠŸ"

         # æ­¥é©Ÿ 10: æ¸…ç†æ•æ„Ÿæª”æ¡ˆ
         - name: Cleanup sensitive files
           if: always()
           run: |
             echo "=== æ¸…ç†æ•æ„Ÿæª”æ¡ˆ ==="
             rm -f ~/.clasprc.json
             echo "âœ… æ•æ„Ÿæª”æ¡ˆæ¸…ç†å®Œæˆ"

         # æ­¥é©Ÿ 11: éƒ¨ç½²å¤±æ•—è™•ç†
         - name: Handle deployment failure
           if: failure()
           run: |
             echo "âŒ éƒ¨ç½²å¤±æ•—è¨ºæ–·"
             echo ""
             echo "å¯èƒ½åŸå› :"
             echo "1. CLASPRC_JSON secret æ ¼å¼éŒ¯èª¤æˆ–éæœŸ"
             echo "2. Apps Script API æœªåœ¨å€‹äººå¸³æˆ¶ä¸­å•Ÿç”¨"
             echo "3. OAuth token éœ€è¦åˆ·æ–°"
             echo "4. å°ˆæ¡ˆæ¬Šé™ä¸è¶³"
             echo ""
             echo "è§£æ±ºæ–¹æ¡ˆ:"
             echo "1. é‡æ–°åŸ·è¡Œ clasp login ä¸¦æ›´æ–° CLASPRC_JSON"
             echo "2. ç¢ºèª https://script.google.com/home/usersettings å·²å•Ÿç”¨ API"
             echo "3. æª¢æŸ¥å°ˆæ¡ˆå…±äº«æ¬Šé™"
   ```

## ğŸ§ª ç¬¬äº”éšæ®µï¼šåŸ·è¡Œé¦–æ¬¡éƒ¨ç½²æ¸¬è©¦

### æ­¥é©Ÿ 5.1ï¼šæäº¤ä»£ç¢¼åˆ° GitHub

1. **æ·»åŠ æ‰€æœ‰æª”æ¡ˆåˆ° Git**
   ```cmd
   git add .
   git status
   ```

2. **æª¢æŸ¥è¦æäº¤çš„æª”æ¡ˆæ¸…å–®**
   ```
   æ‡‰è©²åŒ…å«ï¼š
   âœ… .clasp.json
   âœ… .github/workflows/deploy-to-gas.yml
   âœ… .gitignore
   âœ… appsscript.json
   âœ… code.gs
   âœ… index.html
   
   ä¸æ‡‰åŒ…å«ï¼š
   âŒ .clasprc.json (å·²åœ¨ .gitignore ä¸­)
   âŒ node_modules/
   ```

3. **æäº¤è®Šæ›´**
   ```cmd
   git commit -m "Initial setup: GitHub Actions + Apps Script deployment"
   ```

4. **æ¨é€åˆ° GitHub**
   ```cmd
   git push -u origin main
   ```

### æ­¥é©Ÿ 5.2ï¼šç›£æ§ GitHub Actions åŸ·è¡Œ

1. **å‰å¾€ Actions é é¢**
   ```
   https://github.com/XXXUSER/XXX-vote-time/actions
   ```

2. **è§€å¯Ÿ Workflow åŸ·è¡Œ**
   - é»æ“Šæœ€æ–°çš„ workflow run
   - é»æ“Šã€Œdeployã€job
   - å³æ™‚è§€å¯Ÿæ¯å€‹æ­¥é©Ÿçš„åŸ·è¡Œçµæœ

3. **é—œéµæª¢æŸ¥é»**

   ```mermaid
   %%{init: {'theme': 'dark', 'themeVariables': { 'fontSize': '20px', 'fontFamily': 'Arial' }}}%%
   graph TD
       A[Checkout repository] --> B[Setup Node.js]
       B --> C[Install clasp]
       C --> D[Setup OAuth Authentication]
       D --> E[Verify project configuration]
       E --> F[Prepare deployment files]
       F --> G[Test clasp connection]
       G --> H[Push files to Google Apps Script]
       H --> I[Generate deployment report]
       I --> J[Cleanup sensitive files]
       
       style D fill:#1f2937,stroke:#3b82f6,color:#fff
       style G fill:#1f2937,stroke:#10b981,color:#fff
       style H fill:#1f2937,stroke:#f59e0b,color:#fff
   ```

### æ­¥é©Ÿ 5.3ï¼šé©—è­‰éƒ¨ç½²çµæœ

#### åœ¨ GitHub Actions ä¸­é©—è­‰

**é æœŸæˆåŠŸè¼¸å‡º**ï¼š
```
ğŸ‰ æª”æ¡ˆæ¨é€æˆåŠŸï¼
â±ï¸ æ¨é€è€—æ™‚: 3 ç§’
âœ… æ‰€æœ‰æª”æ¡ˆå·²æ›´æ–°åˆ° Google Apps Script

ğŸ‰ éƒ¨ç½²å®Œæˆæ™‚é–“: 2025-06-21 14:30:00 UTC
ğŸ“ å°ˆæ¡ˆ ID: 1XXXrs_y00guMps5yK2o14nXXXLG0yAhI8JCbY7My-lrQAhUE91aXXXJ
ğŸ”— ç·¨è¼¯å™¨é€£çµ: https://script.google.com/home/projects/1XXXrs_y00guMps5yK2o14nXXXLG0yAhI8JCbY7My-lrQAhUE91aXXXJ/edit
ğŸ“ Commit: abcd123
ğŸ“Š æ¨é€æª”æ¡ˆæ•¸é‡: 3
âœ… èªè­‰æ–¹å¼: OAuth
```

#### åœ¨ Apps Script ç·¨è¼¯å™¨ä¸­é©—è­‰

1. **å‰å¾€ç·¨è¼¯å™¨**
   ```
   https://script.google.com/home/projects/1XXXrs_y00guMps5yK2o14nXXXLG0yAhI8JCbY7My-lrQAhUE91aXXXJ/edit
   ```

2. **æª¢æŸ¥æª”æ¡ˆåˆ—è¡¨**
   ```
   æ‡‰è©²çœ‹åˆ°ï¼š
   âœ… appsscript.json
   âœ… code.gs  
   âœ… index.html
   ```

3. **æª¢æŸ¥æª”æ¡ˆå…§å®¹**
   - æ‰“é–‹æ¯å€‹æª”æ¡ˆ
   - ç¢ºèªå…§å®¹èˆ‡æœ¬åœ°æª”æ¡ˆä¸€è‡´
   - ç‰¹åˆ¥æ³¨æ„æ™‚é–“æˆ³å’Œç‰ˆæœ¬è™Ÿ

4. **æ¸¬è©¦åŠŸèƒ½**
   ```
   åœ¨ Apps Script ç·¨è¼¯å™¨ä¸­ï¼š
   1. é»æ“Šã€ŒåŸ·è¡Œã€â†’ é¸æ“‡ testFunction
   2. æª¢æŸ¥æ—¥èªŒè¼¸å‡º
   3. ç¢ºèªåŠŸèƒ½æ­£å¸¸é‹ä½œ
   ```

## ğŸ”„ ç¬¬å…­éšæ®µï¼šå»ºç«‹æŒçºŒéƒ¨ç½²æµç¨‹

### æ­¥é©Ÿ 6.1ï¼šæ¸¬è©¦è‡ªå‹•éƒ¨ç½²

ç¾åœ¨æ¸¬è©¦å®Œæ•´çš„è‡ªå‹•éƒ¨ç½²æµç¨‹ï¼š

1. **ä¿®æ”¹ code.gs æª”æ¡ˆ**
   ```javascript
   // åœ¨ testFunction ä¸­æ·»åŠ ä¸€è¡Œ
   function testFunction() {
     console.log('ğŸ‰ GitHub Actions è‡ªå‹•éƒ¨ç½²æ¸¬è©¦æˆåŠŸï¼');
     console.log('éƒ¨ç½²æ™‚é–“ï¼š' + new Date().toLocaleString('zh-TW'));
     console.log('ğŸ”„ æ¸¬è©¦è‡ªå‹•éƒ¨ç½²æ›´æ–° - ' + new Date().toISOString()); // æ–°å¢é€™è¡Œ
     return 'éƒ¨ç½²æ¸¬è©¦æˆåŠŸ - ' + new Date().toISOString();
   }
   ```

2. **æäº¤ä¸¦æ¨é€è®Šæ›´**
   ```cmd
   git add code.gs
   git commit -m "Test: æ¸¬è©¦è‡ªå‹•éƒ¨ç½²åŠŸèƒ½"
   git push
   ```

3. **è§€å¯Ÿè‡ªå‹•è§¸ç™¼çš„éƒ¨ç½²**
   - GitHub Actions æ‡‰è©²è‡ªå‹•é–‹å§‹åŸ·è¡Œ
   - ç­‰å¾…éƒ¨ç½²å®Œæˆ
   - æª¢æŸ¥ Apps Script ç·¨è¼¯å™¨ä¸­çš„æª”æ¡ˆæ˜¯å¦å·²æ›´æ–°

### æ­¥é©Ÿ 6.2ï¼šè¨­ç½®æ‰‹å‹•éƒ¨ç½²è§¸ç™¼

æœ‰æ™‚éœ€è¦æ‰‹å‹•è§¸ç™¼éƒ¨ç½²ï¼Œworkflow å·²åŒ…å«æ­¤åŠŸèƒ½ï¼š

1. **å‰å¾€ GitHub Actions**
   ```
   https://github.com/XXXUSER/XXX-vote-time/actions
   ```

2. **æ‰‹å‹•è§¸ç™¼éƒ¨ç½²**
   - é»æ“Šã€ŒDeploy to Google Apps Scriptã€workflow
   - é»æ“Šã€ŒRun workflowã€
   - è¼¸å…¥éƒ¨ç½²èªªæ˜ï¼ˆå¯é¸ï¼‰
   - é»æ“Šã€ŒRun workflowã€

3. **ç›£æ§æ‰‹å‹•éƒ¨ç½²çµæœ**
   - ç¢ºèªéƒ¨ç½²æˆåŠŸ
   - æª¢æŸ¥ Apps Script ä¸­çš„æª”æ¡ˆæ›´æ–°

## ğŸ“Š å¯¦æˆ°æˆæœæª¢é©—

### æˆåŠŸæŒ‡æ¨™æª¢æŸ¥æ¸…å–®

å®Œæˆå¯¦æˆ°ç¯‡å¾Œï¼Œæ‚¨æ‡‰è©²é”åˆ°ä»¥ä¸‹æˆæœï¼š

#### âœ… æŠ€è¡“æˆæœ

- [ ] **GitHub Actions Workflow æ­£å¸¸é‹ä½œ**
  - Push è§¸ç™¼è‡ªå‹•éƒ¨ç½² âœ…
  - æ‰‹å‹•è§¸ç™¼éƒ¨ç½² âœ…
  - åŸ·è¡Œæ™‚é–“ < 5 åˆ†é˜ âœ…

- [ ] **æª”æ¡ˆåŒæ­¥æˆåŠŸ**
  - æ‰€æœ‰æª”æ¡ˆéƒ½æ¨é€åˆ° Apps Script âœ…
  - æª”æ¡ˆå…§å®¹èˆ‡æœ¬åœ°ä¸€è‡´ âœ…
  - ä¿®æ”¹å¾Œèƒ½è‡ªå‹•åŒæ­¥ âœ…

- [ ] **èªè­‰æ©Ÿåˆ¶ç©©å®š**
  - OAuth èªè­‰æ­£å¸¸é‹ä½œ âœ…
  - GitHub Secrets é…ç½®æ­£ç¢º âœ…
  - ç„¡ 403 æˆ–èªè­‰éŒ¯èª¤ âœ…

#### âœ… æµç¨‹æˆæœ

- [ ] **é–‹ç™¼æµç¨‹é †æš¢**
  ```
  æœ¬åœ°ä¿®æ”¹ â†’ git push â†’ è‡ªå‹•éƒ¨ç½² â†’ Apps Script æ›´æ–°
  ```

- [ ] **ç›£æ§æ©Ÿåˆ¶å®Œæ•´**
  - GitHub Actions æ—¥èªŒè©³ç´° âœ…
  - éŒ¯èª¤è¨Šæ¯æ˜ç¢º âœ…
  - éƒ¨ç½²å ±å‘Šå®Œæ•´ âœ…

- [ ] **ç¶­è­·æˆæœ¬ä½**
  - ç„¡éœ€æ‰‹å‹•æ“ä½œ âœ…
  - é…ç½®ä¸€æ¬¡é•·æœŸä½¿ç”¨ âœ…
  - æ•…éšœæ’é™¤å®¹æ˜“ âœ…

### æ€§èƒ½åŸºæº–

åŸºæ–¼å¯¦æˆ°ç¶“é©—çš„æ€§èƒ½åŸºæº–ï¼š

| æŒ‡æ¨™ | ç›®æ¨™å€¼ | å¯¦éš›é”æˆ | ç‹€æ…‹ |
|------|--------|----------|------|
| **éƒ¨ç½²æˆåŠŸç‡** | 95%+ | 100% | âœ… è¶…æ¨™ |
| **éƒ¨ç½²æ™‚é–“** | < 5 åˆ†é˜ | 2-3 åˆ†é˜ | âœ… è¶…æ¨™ |
| **æª”æ¡ˆåŒæ­¥æº–ç¢ºç‡** | 100% | 100% | âœ… é”æ¨™ |
| **éŒ¯èª¤æ¢å¾©æ™‚é–“** | < 10 åˆ†é˜ | < 5 åˆ†é˜ | âœ… è¶…æ¨™ |
| **é…ç½®è¤‡é›œåº¦** | ä¸­ç­‰ | ç°¡å–® | âœ… è¶…æ¨™ |

## ğŸ¯ ä¸‹ä¸€æ­¥å­¸ç¿’å»ºè­°

æ­å–œæ‚¨å®Œæˆå¯¦æˆ°ç¯‡ï¼ç¾åœ¨æ‚¨å·²ç¶“ï¼š
- âœ… å»ºç«‹äº†å®Œæ•´çš„è‡ªå‹•éƒ¨ç½²æµç¨‹
- âœ… æŒæ¡äº† OAuth èªè­‰æ–¹æ¡ˆ
- âœ… å…·å‚™äº†åŸºæœ¬çš„ç¶­è­·èƒ½åŠ›

### æ¨è–¦å¾ŒçºŒå­¸ç¿’è·¯ç·š

æ ¹æ“šæ‚¨çš„éœ€æ±‚é¸æ“‡ï¼š

- **âš ï¸ æƒ³é¿å…å¸¸è¦‹éŒ¯èª¤ï¼Ÿ** â†’ [04_é¿å‘ç¯‡ï¼šå¸¸è¦‹éŒ¯èª¤èˆ‡è§£æ±º](./04_é¿å‘ç¯‡_å¸¸è¦‹éŒ¯èª¤èˆ‡è§£æ±º.md)
- **ğŸ” æƒ³æŒæ¡æ•…éšœæ’é™¤ï¼Ÿ** â†’ [05_æ•…éšœæ’é™¤ç¯‡ï¼šè¨ºæ–·èˆ‡ä¿®å¾©](./05_æ•…éšœæ’é™¤ç¯‡_è¨ºæ–·èˆ‡ä¿®å¾©.md)
- **â­ æƒ³å„ªåŒ–å’Œé€²éšï¼Ÿ** â†’ [06_é€²éšç¯‡ï¼šæœ€ä½³å¯¦è¸èˆ‡å„ªåŒ–](./06_é€²éšç¯‡_æœ€ä½³å¯¦è¸èˆ‡å„ªåŒ–.md)

### å¯¦æˆ°ç¶“é©—ç¸½çµ

é€šéæœ¬ç¯‡å¯¦æˆ°ï¼Œæ‚¨å­¸æœƒäº†ï¼š

1. **OAuth èªè­‰çš„æ­£ç¢ºè¨­ç½®æ–¹æ³•**
2. **GitHub Actions çš„å®Œæ•´é…ç½®æµç¨‹**
3. **clasp CLI çš„å¯¦éš›ä½¿ç”¨æŠ€å·§**
4. **å®Œæ•´çš„æ¸¬è©¦å’Œé©—è­‰æ–¹æ³•**

é€™äº›æŠ€èƒ½å°‡æˆç‚ºæ‚¨å¾ŒçºŒé–‹ç™¼çš„å …å¯¦åŸºç¤ï¼

---

**ğŸ“ å¯¦æˆ°å®Œæˆç‹€æ…‹**
- âœ… 01_æ¦‚è¦½ç¯‡ï¼šæ¶æ§‹ç†è§£èˆ‡è·¯ç·šåœ–
- âœ… 02_åŸºç¤ç¯‡ï¼šç’°å¢ƒæº–å‚™èˆ‡æ ¸å¿ƒæ¦‚å¿µ  
- âœ… 03_å¯¦æˆ°ç¯‡ï¼šé€æ­¥å¯¦æ–½æŒ‡å—
- â³ 04_é¿å‘ç¯‡ï¼šå¸¸è¦‹éŒ¯èª¤èˆ‡è§£æ±º
- â³ 05_æ•…éšœæ’é™¤ç¯‡ï¼šè¨ºæ–·èˆ‡ä¿®å¾©æŒ‡å—
- â³ 06_é€²éšç¯‡ï¼šæœ€ä½³å¯¦è¸èˆ‡å„ªåŒ–

**ğŸ‰ æ­å–œæ‚¨å®Œæˆäº†æœ€é‡è¦çš„å¯¦æˆ°éƒ¨åˆ†ï¼æ‚¨ç¾åœ¨æ“æœ‰äº†ä¸€å€‹å®Œå…¨å¯ç”¨çš„è‡ªå‹•éƒ¨ç½²æ–¹æ¡ˆï¼**
